async function generatePlan() {
    const businessType = document.getElementById('businessType').value.trim();
    const targetAudience = document.getElementById('targetAudience').value.trim();
    const resultDiv = document.getElementById('planResult');

    if (!businessType || !targetAudience) {
        resultDiv.innerHTML = '<div class="error">❌ Заполните все поля</div>';
        return;
    }

    resultDiv.innerHTML = '<div class="loading">⏳ Генерируем контент-план...</div>';

    try {
        const res = await fetch(`${API_BASE}/generate-plan`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ businessType, targetAudience, userId: Telegram.WebApp.initDataUnsafe.user.id })
        });
        if (!res.ok) throw new Error(res.statusText);
        const data = await res.json();
        if (data.success) {
            resultDiv.innerHTML = `<div class="success"><pre>${data.plan}</pre></div>`;
        } else {
            resultDiv.innerHTML = `<div class="error">❌ ${data.error}</div>`;
        }
    } catch (e) {
        resultDiv.innerHTML = '<div class="error">❌ Сервис недоступен</div>';
    }
}
